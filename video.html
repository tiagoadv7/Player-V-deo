<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reproduzindo Vídeo</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* Estilos para garantir a transparência */
    body, html {
      background-color: transparent; /* Transparência para o fundo da janela */
    }

    #videoPlayer {
      opacity: 1;
      transition: opacity 1s ease-out; /* Transição suave de opacidade */
    }
    
    #videoPlayer.fade-out {
      opacity: 0; /* Define a opacidade para 0 no final do fade */
    }
  </style>
</head>
<body class="flex items-center justify-center h-screen">
  <video id="videoPlayer" class="w-full h-full" controls></video>

  <script>
    const { ipcRenderer } = require('electron');
    const videoPlayer = document.getElementById('videoPlayer');
    let fadeInterval;
  
    // Carrega o vídeo ao receber o comando
    ipcRenderer.on('load-video', (event, videoUrl) => {
      videoPlayer.src = videoUrl;
      videoPlayer.play();
  
      // Fecha a janela ao terminar o vídeo com fade-out
      videoPlayer.addEventListener('ended', () => {
        fadeOutAudioAndClose();
      });
    });
  
    // Fechar ao apertar ESC
    window.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        fadeOutAudioAndClose();
      }
    });
  
    // Função para fazer o fade-out do áudio e fechar a janela
    function fadeOutAudioAndClose() {
      videoPlayer.classList.add('fade-out'); // Inicia o fade-out visual
      let volume = videoPlayer.volume;
  
      // Aplica o fade-out de volume
      fadeInterval = setInterval(() => {
        if (volume > 0) {
          volume -= 0.05;
          videoPlayer.volume = Math.max(volume, 0);
        } else {
          clearInterval(fadeInterval);
          setTimeout(() => window.close(), 1000); // Fecha após o fade-out
        }
      }, 100);
    }
  
    // Função para o fade-in do volume ao iniciar o vídeo
    function fadeInAudio() {
      clearInterval(fadeInterval); // Interrompe qualquer fade-out em andamento
      let volume = 0;
      videoPlayer.volume = volume;
      fadeInterval = setInterval(() => {
        if (volume < 1.0) {
          volume = Math.min(volume + 0.05, 1.0);
          videoPlayer.volume = volume;
        } else {
          clearInterval(fadeInterval);
        }
      }, 100);
    }
  
    // Recebe e aplica comandos de controle de vídeo
    ipcRenderer.on('video-action', (event, { action, value }) => {
      switch (action) {
        case 'playPause':
          if (videoPlayer.paused) {
            videoPlayer.play();
            fadeInAudio(); // Inicia o fade-in ao dar play
          } else {
            fadeOutVolume(); // Aplica fade-out no áudio ao pausar
          }
          break;
  
        case 'stop':
          fadeOutAudioAndClose();
          videoPlayer.currentTime = 1; // Reinicia o vídeo para o início
          break;
  
        case 'attenuate':
          videoPlayer.volume = value; // Define o volume para um valor reduzido (ex: 0.2 para 20%)
          break;
  
        case 'volume':
          videoPlayer.volume = value; // Ajusta o volume ao valor especificado
          break;
  
        case 'repeat':
          videoPlayer.loop = !videoPlayer.loop; // Alterna o loop do vídeo
          break;
  
        case 'seek':
          videoPlayer.currentTime = value; // Pula para o tempo especificado
          break;
      }
    });
  
    // Função auxiliar para o fade-out de volume sem fechar o vídeo
    function fadeOutVolume() {
      let volume = videoPlayer.volume;
      clearInterval(fadeInterval);
  
      fadeInterval = setInterval(() => {
        if (volume > 0) {
          volume -= 0.05;
          videoPlayer.volume = Math.max(volume, 0);
        } else {
          videoPlayer.pause();
          clearInterval(fadeInterval);
        }
      }, 100);
    }
  </script>
  
</body>
</html>
