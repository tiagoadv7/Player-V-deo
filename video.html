<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reproduzindo Vídeo</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* Estilos para garantir a transparência */
    body, html {
      background-color: transparent; /* Transparência para o fundo da janela */
    }

    #videoPlayer {
      opacity: 1;
      transition: opacity 1s ease-out; /* Transição suave de opacidade */
    }
    
    #videoPlayer.fade-out {
      opacity: 0; /* Define a opacidade para 0 no final do fade */
    }
  </style>
</head>
<body class="flex items-center justify-center h-screen">
  <video id="videoPlayer" class="w-full h-full" controls></video>

  <script>
    const { ipcRenderer } = require('electron');
    const videoPlayer = document.getElementById('videoPlayer');

    // Carrega o vídeo
    ipcRenderer.on('load-video', (event, videoUrl) => {
      videoPlayer.src = videoUrl;
      videoPlayer.play();

      // Fecha a janela ao terminar o vídeo
      videoPlayer.addEventListener('ended', () => {
        fadeOutAudioAndClose();
      });
    });

    // Fechar ao apertar ESC
    window.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        fadeOutAudioAndClose();
      }
    });

    // Função para fazer o fade-out do vídeo e do áudio
    function fadeOutAudioAndClose() {
      // Inicia o fade-out de opacidade do vídeo
      videoPlayer.classList.add('fade-out');

      // Reduz o volume gradualmente
      let volume = videoPlayer.volume;
      const fadeInterval = setInterval(() => {
        if (volume > 0) {
          volume -= 0.05;
          videoPlayer.volume = Math.max(volume, 0);
        } else {
          clearInterval(fadeInterval);
          setTimeout(() => {
            window.close(); // Fecha a janela quando o fade-out termina
          }, 1000); // Espera a transição de opacidade terminar (1 segundo)
        }
      }, 100); // Reduz o volume gradualmente
    }

    // Escuta para aplicar o fade-out e fechar
    ipcRenderer.on('fade-out', () => {
      fadeOutAudioAndClose();
    });

    // Recebe e aplica comandos de controle de vídeo
    ipcRenderer.on('video-action', (event, { action, value }) => {
      switch (action) {
        case 'playPause':
          if (videoPlayer.paused) {
            videoPlayer.play();
          } else {
            videoPlayer.pause();
          }
          break;

        case 'stop':
          // Executa fade-out e reinicia o vídeo, depois fecha a janela
          fadeOutAudioAndClose();
          videoPlayer.currentTime = 0; // Reinicia o vídeo para o início
          break;

        case 'attenuate':
          videoPlayer.volume = value; // Atenua o volume (ex: 0.8 para 80%)
          break;

        case 'volume':
          videoPlayer.volume = value; // Define o volume para o valor especificado
          break;

        case 'repeat':
          videoPlayer.loop = !videoPlayer.loop; // Alterna o loop do vídeo
          break;

        case 'seek':
          videoPlayer.currentTime = value; // Pula para o tempo especificado
          break;
      }
    });
  </script>
</body>
</html>
